<!DOCTYPE html>
<html lang="fr">
<head>
  <title>Compr√©hension Orale V1</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="bootstrap.min.css">
  <script src="jquery.min.js"></script>
  <script src="popper.min.js"></script>
  <script src="bootstrap.min.js"></script>
  <style>
      body{
        background: url('bg.jpeg') no-repeat center center fixed;
      }

      .home {
  -webkit-background-size: cover;
  -moz-background-size: cover;
  background-size: cover;
  -o-background-size: cover;
}
video {
    width: 100%;
    height: auto;
  }
  
  </style>
</head>
<body>
<!-- Navigation -->
<div id="home" class="home">
<nav class="navbar navbar-expand-lg navbar-light bg-light static-top mb-5 shadow" id="nav">
    <div class="container">
      <a class="navbar-brand" href="#">Compr√©hension Orale V1</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Home
                  <span class="sr-only">(current)</span>
                </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#"></a>
          </li>
        </ul>
      </div>
    </div>
  </nav>


  <!-- Page Content -->
  <div class="container" id="etp1">
    <div class="card border-0 shadow my-5">
      <div class="card-body p-5">
        <h1 class="font-weight-light">Etape 1 : Choix du document</h1>
        <br>
        <div class="alert alert-danger">
          <p><strong>‚ö† L'outil rencontre actuellement des probl√®mes sur le navigateur Firefox. Veuillez privil√©gier Chrome.</p>
            <p>‚ö† La fonction "choix de la fin du document" est indisponible en raison de bugs. </p>
           üì∫ Veuiilez mettre votre navigateur en plein √©cran (Touche F11)</strong>
        </div>
        <p>Pour commencer, veuillez choisir une vid√©o ou un document audio :</p>
        <p><input type="file"  id="myFile"></p>
        <p><button type="button" onclick="goetp2()" class="btn btn-primary btn-block">Suivant</button> </p>
      </div>
    </div>
  </div>


  <div class="container" id="etp2">
    <div class="card border-0 shadow my-5">
      <div class="card-body p-5">
        <h1 class="font-weight-light">Etape 2 : Param√®tres de du docuement</h1>
        <br>
        <p>Veuillez configurer le d√©but du document. Pour cela naviguez dans le player et cliquez sur "Choisir ce point" pour configurer le d√©but de la vid√©o. Si vous voulez que la vid√©o commence √† 0:00:00, continuez √† l'√©tape suivante.</p>
        <table class="table table-hover">
            <tbody>
                <tr>
                    <td colspan="3"><div id=video2 >
                      <video controls id="theVideo1" onended="pause()">
                  </div></td>
                  </tr>
              <tr>
                <td >D√©but du document √† :</td>
                <td id="textedebutvideo">00:00:00</td>
                <td><div class="btn-group">
                  <button type="button" class="btn btn-primary" onclick="getCurTimedebut()">Choisir ce point</button>
                  <button type="button" class="btn btn-danger" onclick="resetDebut()">Remettre a z√©ro</button></td>
                    </div>
              </tr>
              <tr>
                <td >Fin du docuement √† :</td>
                <td id="textefinvideo">00:00:00</td>
                <td><div class="btn-group">
                  </div>           
                </tr>

            </tbody>
          </table>
        <p><button type="button" onclick="goetp3()" class="btn btn-primary btn-block">Suivant</button> </p>
      </div>
    </div>
  </div>
  </div> 

  <div class="container" id="etp3">
    <div class="card border-0 shadow my-5">
      <div class="card-body p-5">
        <h1 class="font-weight-light">Etape 3 : R√©glage du temps</h1>
        <br>
        <p>Pour terminer, veuillez configurer les r√©glages de temps..</p>
        <table class="table table-hover">
          <tbody>
              <tr>
                <td>Nombre d'√©coutes :</td>
                <td><select id="nbecoute"name="cars" class="custom-select mb-3">
                  <option selected>3</option>
                </select></td>
                </tr>
            <tr>
              <td>Pause entre les √©coutes :</td>
              <td><select id="tpspauseecoute"name="cars" class="custom-select mb-3">
                <option value>1</option>
                <option selected>3</option>
                <option value>5</option>
              </select></td>
            </tr>
            <tr>
              <td >Temps de r√©daction:</td>
              <td><select id="tpsredaction"name="cars" class="custom-select mb-3">
                <option value>3</option>
                <option value>5</option>
                <option selected>10</option>
              </select></td>      
              </tr>

          </tbody>
        </table>
        <p><button type="button" onclick="goetp4()" class="btn btn-primary btn-block">Suivant</button> </p>
      </div>
    </div>
  </div>
</div> 
<div class="container-fluid" id="regles">
  <div class="card border-0 shadow my-5">
    <div class="card-body p-5">
      <h1 class="font-weight-light" style="text-align: center;">Quelques r√®gles avant de commencer</h1>
      <br>
      <p class="lead" id="txt1regles">Le document sera diffus√© none fois</p>
      <p class="lead" id="txt2regles">Entre chaque √©coute, une pause de none sera faite</p>
      <p class="lead" id="txt3regles">√Ä la fin des √©coutes, vous aurez none minutes pour r√©diger un compte-rendu en fran√ßais !</p>
      <p><button type="button" onclick="videoplay()" class="btn btn-primary btn-block">Commencer</button> </p>
    </div>
  </div>
</div>

<div class="container-fluid" id="waitentreecoute">
  <div class="card border-0 shadow my-5">
    <div class="card-body p-5">
      <h1 class="font-weight-light" style="text-align: center;" id="waitentreecoutetxt1"></h1>
      <br>
    </div>
  </div>
</div>

<div class="container-fluid" id="fin">
  <div class="card border-0 shadow my-5">
    <div class="card-body p-5">
      <h1 class="font-weight-light" style="text-align: center;">FIN !</h1>
      <br>
    </div>
  </div>
</div>

<div id=video1>
    <video controls id="theVideo2" onended="pause1()">
  </div>

</body>



<script>
var countera = 10;
var intervalIda = null;
var ecouteencours = 0;
var tempsentreecoute = 0;
var nbecoute = 0;
var finvideo = 0;
var debutvideo = 0;
var tempsredaction = 0;
var tempo1 = 0;
var tempo2 = 0;
document.getElementById("etp2").style.display = "none";
document.getElementById("etp3").style.display = "none";
document.getElementById("video1").style.display = "none";
document.getElementById("regles").style.display = "none";
document.getElementById("waitentreecoute").style.display = "none";
document.getElementById("fin").style.display = "none";


document.getElementById("myFile").addEventListener("change", changeVideo);
function changeVideo() {
  var chosenFile = document.getElementById("myFile").files[0];
  document.getElementById("theVideo1").setAttribute("src", URL.createObjectURL(chosenFile));
  document.getElementById("theVideo2").setAttribute("src", URL.createObjectURL(chosenFile));
}
function goetp2(){
    document.getElementById("textefinvideo").innerHTML = (new Date(document.getElementById("theVideo1").duration * 1000).toISOString().substr(11, 8));
    finvideo = document.getElementById("theVideo1").duration;
    document.getElementById("theVideo1").duration;
    document.getElementById("etp1").style.display = "none";
    document.getElementById("etp2").style.display = "block";
}

function getCurTimedebut() {
  var vid = document.getElementById("theVideo1");
  vid.pause();
  document.getElementById("textedebutvideo").innerHTML = new Date(vid.currentTime * 1000).toISOString().substr(11, 8);
  debutvideo = vid.currentTime;
}

function resetDebut() {
  var vid = document.getElementById("theVideo1");
  vid.pause();
  vid.currentTime = 0;
  document.getElementById("textedebutvideo").innerHTML = new Date(0 * 1000).toISOString().substr(11, 8);
  debutvideo = 0;

} 


function goetp3(){
  var vid = document.getElementById("theVideo1");
  vid.pause();
  document.getElementById("etp2").style.display = "none";
  document.getElementById("etp3").style.display = "block";
// Calcul d√©but vid√©o
var hms = document.getElementById("textedebutvideo").textContent;
var a = hms.split(':');
var debutvideo = (+a[0]) * 60 * 60 + (+a[1]) * 60 + (+a[2]); 
console.log(debutvideo);

// Calcul fin vid√©o
var hms = document.getElementById("textefinvideo").textContent;
var a = hms.split(':');
var finvideo = (+a[0]) * 60 * 60 + (+a[1]) * 60 + (+a[2]); 
console.log(finvideo);

// G√©rer interface

}

function goetp4(){
   tempsentreecoute = document.getElementById('tpspauseecoute').options[document.getElementById('tpspauseecoute').selectedIndex].text*60;
   nbecoute = document.getElementById('nbecoute').options[document.getElementById('nbecoute').selectedIndex].text
   tempsredaction = document.getElementById('tpsredaction').options[document.getElementById('tpsredaction').selectedIndex].text*60;
  document.getElementById("etp2").style.display = "none";
  document.getElementById("etp3").style.display = "none";
  document.getElementById("video1").style.display = "none";
  document.getElementById("regles").style.display = "block";
  document.getElementById("etp1").style.display = "none";
  document.getElementById("nav").style.display = "none";
  document.getElementById("home").style.display = "none";
  document.body.style.backgroundImage = "none";
  document.body.style.backgroundColor = "black";
  document.getElementById("txt1regles").innerHTML ="Le document sera diffus√© "+nbecoute+" fois";
  document.getElementById("txt2regles").innerHTML = "Entre chaque √©coute, une pause de "+tempsentreecoute/60+" minute(s) sera faite" ;
  document.getElementById("txt3regles").innerHTML = "√Ä la fin des √©coutes, vous aurez "+tempsredaction/60+" minutes pour r√©diger un compte-rendu en fran√ßais !";
}




function videoplay(){
  var vid = document.getElementById("theVideo2");
  document.getElementById("regles").style.display = "none";
  document.getElementById("video1").style.display = "block";
  console.log(debutvideo);
  vid.currentTime = debutvideo;
  document.getElementById("theVideo2").play();
  ecouteencours = ecouteencours+1;
  console.log(ecouteencours);
}




function pause1(){
  var vid = document.getElementById("theVideo1");

  console.log(Number(nbecoute));
  console.log(Number(ecouteencours));
  if(ecouteencours < Number(nbecoute)){
  countera = tempsentreecoute;
  //countera = 1;
  intervalIda = null;
  document.getElementById("waitentreecoute").style.display = "block";
  document.getElementById("video1").style.display = "none";
  intervalIda = setInterval(bipa, 1000);

  }
  else {
  countera = tempsredaction;
  //countera = 1;
  intervalIda = null;
  document.getElementById("waitentreecoute").style.display = "block";
  document.getElementById("video1").style.display = "none";
  intervalIda = setInterval(bipa, 1000);  }

}



function bipa() {
  var vid = document.getElementById("theVideo1");

    countera--;
    if(countera == 0) {
      if(ecouteencours < Number(nbecoute)){
        clearInterval(intervalIda);
        document.getElementById("waitentreecoute").style.display = "none";
        document.getElementById("video1").style.display = "block";
        videoplay();
      } else {
        document.getElementById("fin").style.display = "block";
        document.getElementById("waitentreecoutetxt1").innerHTML = "TERMINE !";
        document.getElementById("waitentreecoute").style.display = "none";

      }

    }
    else {
      if(ecouteencours < Number(nbecoute)){
        document.getElementById("waitentreecoutetxt1").innerHTML = "Prochaine √©coute dans "+new Date(countera * 1000).toISOString().substr(11, 8);
    } else {
      document.getElementById("waitentreecoutetxt1").innerHTML = "Fin dans "+new Date(countera * 1000).toISOString().substr(11, 8);
    }
    }
    }



</script>
